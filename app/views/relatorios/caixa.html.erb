<div style="display: flex; align-items: center;" class="mt-5 mb-5 justify-content-center">
  <h1>Caixa e Despesas</h1>
</div>

<div class="container-fluid px-1 px-md-5 px-lg-1 px-xl-5 py-5 mx-auto">
  <div class="border-0">
    <div class="row d-flex">
      <%= form_tag relatorios_caixa_path, method: :get, class: "form-inline card mb-3 mt 3" do %>
        <div class="row m-4">
          <div class="col-md-3 mt-2 " style="margin-left: 10px;">
            <div class="field form-floating ">
              <%= date_field_tag :min, params[:min] ||= Date.today , class: 'form-control' %>
              <%= label_tag "Data: "%>
            </div>
          </div>
          <div class="col-md-2 mt-3">
            <div class="field form-floating" style="margin-left: 10px;">
              <%= button_tag(value: "commit", type: 'submit', class: "btn btn-dark") do %>
                <i class="fa fa-search"></i> Pesquisar
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
      <div  class="accordion" id="accordionPanelsStayOpenExample">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
              <h5> Total de receitas <i class="fa fa-question-circle" id="tooltip-acordeon" title="<%=total_receitas%>"></i></h5>
            </button>
          </h2>
          <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
            <div class="accordion-body">
              <p>No dia: R$ <%= @receitas_dia.sum(&:total) %></p>
              <p>Na última semana: R$ <%= @receitas_semana.sum(&:total).round(2) %></p>
              <p>No último mês: R$ <%= @receitas_mes.sum(&:total).round(2) %></p>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
            <h5> Total de despesas <i class="fa fa-question-circle" id="tooltip-acordeon" title="<%= total_despesas %>"></i></h5>
            </button>
          </h2>
          <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
            <div class="accordion-body">
              <p>No dia : R$ <%= @despesas_dia.sum(:valor).round(2) %></p>
              <p>Na última semana: R$ <%=  @despesas_semana.sum(:valor).round(2)%></p>
              <p>No último mês: R$ <%= @despesas_mes.sum(:valor).round(2) %></p>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
              <h5>Detalhes de Despesas <i class="fa fa-question-circle" id="tooltip-acordeon" title="<%= detalhes_despesas %>"></i></h5>
            </button>
          </h2> 
          <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
            <div class="accordion-body">
              <p>Perido de <%= l @periodo_de, format: :default%> até <%=l @periodo_ate, format: :default%></p>
              <% aux = 1 %>
              <% @soma_por_categoria.each do |categoria| %>
                <%= "#{aux}. #{categoria[:categoria]}: R$ #{categoria[:total]}"%><br>
                <% aux += 1%>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <div  class="accordion" id="accordionPanelsStayOpenExample">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
              <h5> Graficos de Categoria <i class="fa fa-question-circle" id="tooltip-acordeon" title="<%= grafico_despesas %>"></i></h5>
            </button>
          </h2> 
          <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
            <div class="accordion-body">
              <canvas id="despesasPorCategoria" width="50%" height="50%"></canvas>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
              <h5>Lucro Liquido <i class="fa fa-question-circle" id="tooltip-acordeon" title="<%= lucro_liquido %>"></i></h5>
            </button>
          </h2> 
          <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
            <div class="accordion-body">
              <p>No dia : R$ <%= @lucro_liquido_dia.round(2) %></p>
              <p>Na última semana: R$ <%= @lucro_liquido_semana.round(2) %></p>
              <p>No último mês: R$ <%= @lucro_liquido_mes.round(2) %></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  var chartData = <%= @chart_data.to_json.html_safe %>;
  var ctx = document.getElementById('despesasPorCategoria').getContext('2d');

  var options = {
    responsive: true,
    maintainAspectRatio: false
  };

  var myPieChart = new Chart(ctx, {
    type: 'pie',
    data: chartData,
    options: options
  });

</script>